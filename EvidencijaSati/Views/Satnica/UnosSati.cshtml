@model EvidencijaSati.Models.ViewModels.UnosSatiVM

@Scripts.Render("~/bundles/dataTables")
@Styles.Render("~/Content/dataTables")
@Styles.Render("~/Content/unosSati")

<h1>Pozdrav @Model.Djelatnik.Ime !</h1>

<div class="container">
	 <div class="row dateRow">
		  <p>Bileže se sati za <b><span id="txtDatum"></span></b></p>
		  <button id="btnDrugiDatum"
					 class="btn btn-outline-primary"
					 type="button">Odaberi drugi datum</button>
	 </div>
	 <div class="row">
		  <div class="card card-body">

				<table id="table" style="width: 100%">
					 <thead>
						  <tr>
								<th>Projekt</th>
								<th>Zabilježeno</th>
								<th>Start / Stop</th>
								<th>Radni sati</th>
								<th>Prekovremeni sati</th>
								<th>Detalji</th>
						  </tr>
						  </thead>
					 <tbody>
					 @for (int i = 0; i < Model.Projekti.Count; i++)
					 {
						  <tr class="@Model.Projekti[i].IDProjekt rowProjekt">
								<td>@Model.Projekti[i].Naziv</td>
								<td id="@("txtZab" + Model.Projekti[i].IDProjekt)" class="zabiljezeno">
									 @(Model.Satnica.ProjektZabiljezeno[Model.Projekti[i].IDProjekt])
								</td>
						  	 	<td>
								<button id="@("btnProjekt" + Model.Projekti[i].IDProjekt)"
										  class="btn btn-success btnTimer @i"
										  type="button">Start
								</button>
								</td>
						  	 	<td></td>
						  	 	<td></td>
						  	 	<td><a href="#"><i class="fa fa-info-circle fa-3x" style="color: grey;"></i></a></td>
						  </tr>
					 }
					 </tbody>
					 <tfoot>
						  <tr>
								<td>Ukupno</td>
								<td><b>@Model.Satnica.GetFormatedProperties("total")</b></td>
								<td></td>
								<td><b>@Model.Satnica.GetFormatedProperties("redovni")</b></td>
								<td><b>@Model.Satnica.GetFormatedProperties("prekovremeni")</b></td>
								<td></td>
						  </tr>
					 </tfoot>
				</table>

		  </div>
		  </div>
	 <div class="row justify-content-center">
		  <div class="col col-3"><button class="btn btn-outline-danger">Odustani</button></div>
		  <div class="col col-3"><button class="btn btn-primary">Spremi</button></div>
		  <div class="col col-3"><button class="btn btn-warning">Predaj</button></div>
	 </div>

</div>

<script type="text/javascript">


	 $(document).ready(function () {

		  var datum = "@Model.Satnica.Datum.ToString()".split(" ")[0];

		  $('#txtDatum').html(datum);

		  var projectId, start, end;

		  var table = $("#table").DataTable({
				select: true,
				paging: false,
				ordering: false,
				info: false,
				searching: false,
				columnDefs: [
					 {
						  targets: 1,
						  className: 'dt-body-center'
					 },
					 {
						  targets: 3,
						  className: 'dt-body-center'
					 },
					 {
						  targets: 4,
						  className: 'dt-body-center'
					 },
					 {
						  targets: 5,
						  className: 'dt-body-center'
					 }
				]
		  });

		  $('button.btnTimer').click(function (e) {
				e.preventDefault();

				if ($(this).hasClass('btn-success')) {
					 start = new Date();
					 if (isProject(this.id)) {
						  projectId = this.id.split('btnProjekt')[1];
					 } else {
						  projectId = this.id.split('btn')[1];
					 }

					 $(this).removeClass('btn-success');
					 $(this).addClass('btn-danger');
					 $(this).html('Stop');

					 $('button.btn-success').prop('disabled', true);

				} else {
					 end = new Date();

					 $('button.btn-success').prop('disabled', false);

					 $(this).removeClass('btn-danger');
					 $(this).addClass('btn-success');
					 $(this).html('Start');


					 var model = {
						  IDSatnicaProjekta: -1,
						  SatnicaID: @Model.Satnica.IDSatnica,
						  ProjektID: projectId.toString(),
						  Start: start,
						  End: end
					 };


					 $.ajax({
						  url: "@Url.Action("SpremiTempSatnicu")",
						  method: "POST",
						  data: JSON.stringify(model),
						  contentType: 'application/json',
						  success: function (res) {
								//res[0] row
								//res[1] zabiljezeno
								//res[2] prekovremeno?

								table.cell(res[0], 1, 0).data(res[1]).draw();

								if (res[2]) {
									 console.log(res[2]);
								}

								console.log(res);
						  }
					 });


				}

		  });


		  function isProject(id) {
				if (id == 'btnBolovanje' || id == 'btnGodisnji' || id == 'btnPutovanje') {
					 return false;
				} else {
					 return true;
				}
		  }

	 });



</script>